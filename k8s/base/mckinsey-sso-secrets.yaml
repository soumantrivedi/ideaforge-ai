apiVersion: v1
kind: Secret
metadata:
  name: mckinsey-sso-secrets
  namespace: ideaforge-ai
  labels:
    app: ideaforge-ai
    component: auth
    security: high
  annotations:
    description: "McKinsey SSO OAuth 2.0 / OIDC credentials and encryption keys"
type: Opaque
stringData:
  # ============================================================================
  # McKinsey OIDC Client Credentials
  # ============================================================================
  # OAuth 2.0 Client ID issued by McKinsey Identity Platform
  # Obtain from: McKinsey Identity Platform team
  # Security: Not highly sensitive, but should not be publicly exposed
  MCKINSEY_CLIENT_ID: "your-mckinsey-client-id-here"
  
  # OAuth 2.0 Client Secret for authenticating with McKinsey Identity Platform
  # Obtain from: McKinsey Identity Platform team (provided with Client ID)
  # Security: CRITICAL - Must be kept secret, rotate regularly
  MCKINSEY_CLIENT_SECRET: "your-mckinsey-client-secret-here"
  
  # ============================================================================
  # McKinsey OAuth Callback Configuration
  # ============================================================================
  # OAuth callback URL where McKinsey redirects after authentication
  # Must match the redirect URI registered with McKinsey Identity Platform
  # Format: https://your-domain.com/api/auth/mckinsey/callback
  # Examples:
  #   Production: https://ideaforge-ai-prod.cf.platform.mckinsey.cloud/api/auth/mckinsey/callback
  #   Development: http://localhost:80/api/auth/mckinsey/callback
  MCKINSEY_REDIRECT_URI: "https://your-app-domain.com/api/auth/mckinsey/callback"
  
  # ============================================================================
  # McKinsey Token Encryption
  # ============================================================================
  # 32-byte Fernet encryption key for encrypting refresh tokens at rest
  # Generate using: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
  # Security: CRITICAL - Must be kept secret, rotate regularly
  # Note: Rotating this key will invalidate all existing encrypted tokens
  MCKINSEY_TOKEN_ENCRYPTION_KEY: "your-32-byte-fernet-encryption-key-here"
  
  # ============================================================================
  # McKinsey OIDC Endpoints (Optional - defaults provided)
  # ============================================================================
  # These have sensible defaults in the application config
  # Only override if McKinsey changes their identity provider URLs
  
  # MCKINSEY_AUTHORIZATION_ENDPOINT: "https://auth.mckinsey.id/auth/realms/r/protocol/openid-connect/auth"
  # MCKINSEY_TOKEN_ENDPOINT: "https://auth.mckinsey.id/auth/realms/r/protocol/openid-connect/token"
  # MCKINSEY_JWKS_URI: "https://auth.mckinsey.id/auth/realms/r/protocol/openid-connect/certs"

---
# ============================================================================
# INSTRUCTIONS FOR CREATING THIS SECRET
# ============================================================================
#
# DO NOT apply this template directly to production!
# This file contains placeholder values for documentation purposes.
#
# To create the secret in your cluster:
#
# Method 1: Create from literal values (recommended for production)
# ---------------------------------------------------------------
# kubectl create secret generic mckinsey-sso-secrets \
#   --from-literal=MCKINSEY_CLIENT_ID='your-actual-client-id' \
#   --from-literal=MCKINSEY_CLIENT_SECRET='your-actual-client-secret' \
#   --from-literal=MCKINSEY_REDIRECT_URI='https://your-domain.com/api/auth/mckinsey/callback' \
#   --from-literal=MCKINSEY_TOKEN_ENCRYPTION_KEY='your-actual-encryption-key' \
#   --namespace=your-namespace
#
# Method 2: Create from environment file
# ---------------------------------------
# 1. Create a file named mckinsey-sso.env with your actual values:
#    MCKINSEY_CLIENT_ID=your-actual-client-id
#    MCKINSEY_CLIENT_SECRET=your-actual-client-secret
#    MCKINSEY_REDIRECT_URI=https://your-domain.com/api/auth/mckinsey/callback
#    MCKINSEY_TOKEN_ENCRYPTION_KEY=your-actual-encryption-key
#
# 2. Create the secret:
#    kubectl create secret generic mckinsey-sso-secrets \
#      --from-env-file=mckinsey-sso.env \
#      --namespace=your-namespace
#
# 3. Delete the env file immediately:
#    rm mckinsey-sso.env
#
# Method 3: Use External Secrets Operator (recommended for production)
# ---------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: mckinsey-sso-secrets
#   namespace: ideaforge-ai
# spec:
#   secretStoreRef:
#     name: aws-secrets-manager
#     kind: SecretStore
#   target:
#     name: mckinsey-sso-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: MCKINSEY_CLIENT_ID
#       remoteRef:
#         key: ideaforge-ai/mckinsey-sso/client-id
#     - secretKey: MCKINSEY_CLIENT_SECRET
#       remoteRef:
#         key: ideaforge-ai/mckinsey-sso/client-secret
#     - secretKey: MCKINSEY_REDIRECT_URI
#       remoteRef:
#         key: ideaforge-ai/mckinsey-sso/redirect-uri
#     - secretKey: MCKINSEY_TOKEN_ENCRYPTION_KEY
#       remoteRef:
#         key: ideaforge-ai/mckinsey-sso/encryption-key
#
# ============================================================================
# GENERATING ENCRYPTION KEY
# ============================================================================
#
# The MCKINSEY_TOKEN_ENCRYPTION_KEY must be a valid 32-byte Fernet key.
#
# Generate using Python:
# ----------------------
# python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
#
# Generate using OpenSSL:
# -----------------------
# openssl rand -base64 32
#
# Example output:
# xK8vN2pQ5rT9wB3cF6hJ8kL0mP2sU4vX7yA9bD1eG3i=
#
# ============================================================================
# OBTAINING MCKINSEY CREDENTIALS
# ============================================================================
#
# 1. Contact McKinsey Identity Platform team
#    - Email: identity-platform@mckinsey.com (verify actual contact)
#    - Provide: Application name, environment, redirect URIs
#
# 2. McKinsey Identity Platform team will:
#    - Create OAuth 2.0 client in Keycloak
#    - Provide Client ID and Client Secret
#    - Register your redirect URI(s)
#    - Configure scopes (openid, profile, email)
#
# 3. Add credentials to this secret
#
# ============================================================================
# SECURITY BEST PRACTICES
# ============================================================================
#
# 1. Never commit secrets to git
# 2. Use Kubernetes RBAC to restrict secret access
# 3. Rotate MCKINSEY_TOKEN_ENCRYPTION_KEY regularly
# 4. Use External Secrets Operator or AWS Secrets Manager in production
# 5. Enable audit logging for secret access
# 6. Use separate secrets for dev/staging/production
# 7. Monitor for failed authentication attempts
#
# ============================================================================
# VERIFYING SECRET
# ============================================================================
#
# Check if secret exists:
# kubectl get secret mckinsey-sso-secrets -n your-namespace
#
# View secret keys (not values):
# kubectl describe secret mckinsey-sso-secrets -n your-namespace
#
# Decode secret values (use with caution):
# kubectl get secret mckinsey-sso-secrets -n your-namespace -o jsonpath='{.data.MCKINSEY_CLIENT_ID}' | base64 -d
#
# Test if backend can access secret:
# kubectl exec -it deployment/backend -n your-namespace -- env | grep MCKINSEY
#
# ============================================================================
