apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ideaforge-ai-ingress
  namespace: ideaforge-ai
  annotations:
    # AWS ALB Ingress Controller annotations
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:REGION:ACCOUNT_ID:certificate/CERT_ID"  # ⚠️ UPDATE THIS!
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-protocol: HTTP
    alb.ingress.kubernetes.io/healthcheck-port: traffic-port
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: "30"
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: "5"
    alb.ingress.kubernetes.io/healthy-threshold-count: "2"
    alb.ingress.kubernetes.io/unhealthy-threshold-count: "3"
    # Optional: WAF
    # alb.ingress.kubernetes.io/wafv2-acl-arn: "arn:aws:wafv2:REGION:ACCOUNT_ID:webacl/..."
    # Optional: Load Balancer Attributes
    alb.ingress.kubernetes.io/load-balancer-attributes: |
      idle_timeout.timeout_seconds=60,
      routing.http2.enabled=true,
      access_logs.s3.enabled=true,
      access_logs.s3.bucket=your-logs-bucket,  # ⚠️ UPDATE THIS!
      access_logs.s3.prefix=ideaforge-ai
    # Optional: Tags
    alb.ingress.kubernetes.io/tags: Environment=production,Application=IdeaForgeAI
spec:
  rules:
  - host: ideaforge.ai  # ⚠️ UPDATE WITH YOUR DOMAIN!
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend
            port:
              number: 3000
  - host: api.ideaforge.ai  # ⚠️ UPDATE WITH YOUR API DOMAIN!
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: backend
            port:
              number: 8000

---
# Alternative: NGINX Ingress Controller (if using NGINX instead of ALB)
# Uncomment and use this if you prefer NGINX Ingress
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: ideaforge-ai-ingress-nginx
#   namespace: ideaforge-ai
#   annotations:
#     kubernetes.io/ingress.class: nginx
#     cert-manager.io/cluster-issuer: letsencrypt-prod
#     nginx.ingress.kubernetes.io/ssl-redirect: "true"
#     nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
#     nginx.ingress.kubernetes.io/proxy-body-size: "10m"
#     nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
#     nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
# spec:
#   tls:
#   - hosts:
#     - ideaforge.ai
#     - api.ideaforge.ai
#     secretName: ideaforge-ai-tls
#   rules:
#   - host: ideaforge.ai
#     http:
#       paths:
#       - path: /
#         pathType: Prefix
#         backend:
#           service:
#             name: frontend
#             port:
#               number: 3000
#   - host: api.ideaforge.ai
#     http:
#       paths:
#       - path: /
#         pathType: Prefix
#         backend:
#           service:
#             name: backend
#             port:
#               number: 8000

